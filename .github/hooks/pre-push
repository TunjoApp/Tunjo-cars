#!/bin/bash
echo "ğŸ” Running pre-push checks..."

# Abort if any command fails
set -e

# 1ï¸âƒ£ Check for ESLint issues
if [ -f "package.json" ]; then
    echo "ğŸš€ Running ESLint..."
    npx eslint . --ext .js,.jsx,.ts,.tsx
else
    echo "âš ï¸ ESLint skipped (package.json not found)"
fi

# 2ï¸âƒ£ Check for Prettier formatting issues
if [ -f "package.json" ]; then
    echo "âœ¨ Running Prettier check..."
    npx prettier --check .
else
    echo "âš ï¸ Prettier skipped (package.json not found)"
fi

# 3ï¸âƒ£ Run TypeScript compiler (if using TypeScript)
if [ -f "tsconfig.json" ]; then
    echo "ğŸ“Œ Running TypeScript compiler check..."
    npx tsc --noEmit
else
    echo "âš ï¸ TypeScript check skipped (tsconfig.json not found)"
fi



# 5ï¸âƒ£ Check for Uncommitted Migrations (Optional for DB projects)
if [ -d "migrations" ]; then
    echo "ğŸ”„ Checking for uncommitted migrations..."
    if git diff --quiet migrations; then
        echo "âœ… No uncommitted migrations found."
    else
        echo "âŒ ERROR: Uncommitted migrations detected! Please commit your migrations before pushing."
        exit 1
    fi
fi

echo "âœ… All checks passed. Proceeding with push!"
exit 0
